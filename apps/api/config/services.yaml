parameters:

services:
    _defaults:
        autowire: true
        autoconfigure: true

    # Identity Context
    App\Identity\:
        resource: '../src/Identity/'
        exclude:
            - '../src/Identity/Domain/Model/'
            - '../src/Identity/Domain/ValueObject/'
            - '../src/Identity/Domain/Event/'
            - '../src/Identity/Application/Command/'
            - '../src/Identity/Application/DTO/'

    # Repository bindings
    App\Identity\Domain\Repository\UserRepositoryInterface:
        class: App\Identity\Infrastructure\Persistence\Doctrine\UserDoctrineRepository

    App\Bots\Domain\Repository\ProposalRepositoryInterface:
        class: App\Bots\Infrastructure\Persistence\Doctrine\ProposalDoctrineRepository

    # Shared Context
    App\Shared\:
        resource: '../src/Shared/'

    # Market Context
    App\Market\:
        resource: '../src/Market/'
        exclude:
            - '../src/Market/Domain/Model/'
            - '../src/Market/Domain/ValueObject/'
            - '../src/Market/Domain/Event/'

    # News Context
    App\News\:
        resource: '../src/News/'
        exclude:
            - '../src/News/Domain/Model/'
            - '../src/News/Domain/ValueObject/'
            - '../src/News/Domain/Event/'

    # Exchange Context
    App\Exchange\:
        resource: '../src/Exchange/'
        exclude:
            - '../src/Exchange/Domain/Model/'
            - '../src/Exchange/Domain/ValueObject/'
            - '../src/Exchange/Domain/Event/'

    # Portfolio Context
    App\Portfolio\:
        resource: '../src/Portfolio/'
        exclude:
            - '../src/Portfolio/Domain/Model/'
            - '../src/Portfolio/Domain/ValueObject/'
            - '../src/Portfolio/Domain/Event/'

    # Trading Context
    App\Trading\:
        resource: '../src/Trading/'
        exclude:
            - '../src/Trading/Domain/Model/'
            - '../src/Trading/Domain/ValueObject/'
            - '../src/Trading/Domain/Event/'

    # Bots Context
    App\Bots\:
        resource: '../src/Bots/'
        exclude:
            - '../src/Bots/Domain/Model/'
            - '../src/Bots/Domain/ValueObject/'
            - '../src/Bots/Domain/Event/'

    # Risk Context
    App\Risk\:
        resource: '../src/Risk/'
        exclude:
            - '../src/Risk/Domain/Model/'
            - '../src/Risk/Domain/ValueObject/'
            - '../src/Risk/Domain/Event/'

    # Analytics Context
    App\Analytics\:
        resource: '../src/Analytics/'
        exclude:
            - '../src/Analytics/Domain/Model/'
            - '../src/Analytics/Domain/ValueObject/'
            - '../src/Analytics/Domain/Event/'

    # Audit Context
    App\Audit\:
        resource: '../src/Audit/'
        exclude:
            - '../src/Audit/Domain/Model/'
            - '../src/Audit/Domain/ValueObject/'
            - '../src/Audit/Domain/Event/'
            - '../src/Audit/Application/Command/'
            - '../src/Audit/Application/Query/'
            - '../src/Audit/Application/DTO/'

    App\Audit\Domain\Repository\AuditLogRepositoryInterface:
        class: App\Audit\Infrastructure\Persistence\Doctrine\DoctrineAuditLogRepository

    # Alert Context
    App\Alert\:
        resource: '../src/Alert/'
        exclude:
            - '../src/Alert/Domain/Model/'
            - '../src/Alert/Domain/ValueObject/'
            - '../src/Alert/Domain/Event/'
            - '../src/Alert/Application/Command/'
            - '../src/Alert/Application/Query/'
            - '../src/Alert/Application/DTO/'

    # Notification Services
    App\Alert\Domain\Service\NotificationServiceInterface:
        class: App\Alert\Infrastructure\Service\MultiChannelNotificationService

    App\Alert\Infrastructure\Service\EmailNotificationService:
        arguments:
            $fromEmail: '%env(MAIL_FROM)%'
            $fromName: 'invest.ia'

    App\Alert\Infrastructure\Service\PushNotificationService:
        arguments:
            $serverKey: '%env(FCM_SERVER_KEY)%'

    App\Alert\Infrastructure\Service\SmsNotificationService:
        arguments:
            $accountSid: '%env(TWILIO_ACCOUNT_SID)%'
            $authToken: '%env(TWILIO_AUTH_TOKEN)%'
            $fromNumber: '%env(TWILIO_FROM_NUMBER)%'

    App\Alert\Infrastructure\Service\DiscordNotificationService:
        arguments:
            $webhookUrl: '%env(DISCORD_WEBHOOK_URL)%'

    App\Alert\Infrastructure\Service\TelegramNotificationService:
        arguments:
            $botToken: '%env(TELEGRAM_BOT_TOKEN)%'

    # Sentiment Analyzer
    App\News\Domain\Service\SentimentAnalyzerInterface:
        class: App\News\Infrastructure\Service\SimpleSentimentAnalyzer
        # Pour production avec OpenAI:
        # class: App\News\Infrastructure\Service\OpenAISentimentAnalyzer
        # arguments:
        #     $apiKey: '%env(OPENAI_API_KEY)%'

    # Realtime Service (WebSocket)
    App\Shared\Domain\Service\RealtimeServiceInterface:
        class: App\Shared\Infrastructure\Service\MercureRealtimeService
        arguments:
            $mercureUrl: '%env(MERCURE_URL)%'
            $mercureJwtSecret: '%env(MERCURE_JWT_SECRET)%'

    # Rate Limiters
    api_general_limiter:
        class: Symfony\Component\RateLimiter\RateLimiterFactory
        arguments:
            - 'api_general'
            - '@rate_limiter.cache'

    # Controllers
    App\Identity\UI\Http\Controller\:
        resource: '../src/Identity/UI/Http/Controller/'
        tags: ['controller.service_arguments']

    App\Shared\UI\Http\Controller\:
        resource: '../src/Shared/UI/Http/Controller/'
        tags: ['controller.service_arguments']
